<?xml version="1.0" encoding="UTF-8"?>
<xquery>
<declare><![CDATA[
      declare namespace xs = "http://www.w3.org/2001/XMLSchema";
      ]]>
    </declare>
    <for><![CDATA[
      for $a in /TEI.2//div1/div2                 
      ]]>
    </for>
    <let><![CDATA[
      let $time := xmldb:last-modified(util:collection-name($a), util:document-name($a))
      let $oaitime := local:utcdatetime($time)
      let $root := fn:root($a)
      let $issue := $a/..
      ]]>                
    </let>    <where verb="GetRecord"><![CDATA[
        $article/@id = "?"
        ]]>
    </where>
    <where>
 <!-- DEFAULT query is used when a set is not requested and should return all records -->
      <set setSpec="DEFAULT" />                   
 <!-- not implementing sets at this time
     <set setSpec="Articles"><![CDATA[
          $a//div2/@type= 'Article'
          ]]>
      </set>
      <set setSpec="Reviews"><![CDATA[
          $a//div2/@type = 'Review'
         ]]>                        
      </set>
      <set setSpec="vol1"><![CDATA[
         $a//sourceDesc/bibl/biblScope[@type='volume'] = 'Volume 1']
          ]]>
      </set>
      <set setSpec="vol2"><![CDATA[
          $a/sourceDesc/bibl/biblScope[@type='volume'] = 'Volume 2']
          ]]>
      </set>
      <set setSpec="vol3"><![CDATA[
         $a/sourceDesc/bibl/biblScope[@type='volume'] = 'Volume 3')
          ]]>
      </set>
      <set setSpec="vol4"><![CDATA[
         $a/sourceDesc/bibl/biblScope[@type='volume'] = 'Volume 4')
          ]]>
      </set>
      <set setSpec="vol5"><![CDATA[
         $a/sourceDesc/bibl/biblScope[@type='volume'] = 'Volume 5')
          ]]>
      </set>
      <set setSpec="vol6"><![CDATA[
         $a/sourceDesc/bibl/biblScope[@type='volume'] = 'Volume 6')
          ]]>
      </set>
      <set setSpec="vol7"><![CDATA[
         $a/sourceDesc/bibl/biblScope[@type='volume'] = 'Volume 7')
          ]]>
      </set>
      <set setSpec="vol8"><![CDATA[
         $a/sourceDesc/bibl/biblScope[@type='volume'] = 'Volume 8')
          ]]>
      </set>
      <set setSpec="vol9"><![CDATA[
         $a/sourceDesc/bibl/biblScope[@type='volume'] = 'Volume 9')
          ]]>
      </set>
      <set setSpec="vol10"><![CDATA[
         $a/sourceDesc/bibl/biblScope[@type='volume'] = 'Volume 10')
          ]]>
      </set> -->
      <from><![CDATA[
         $time >= xs:dateTime("?")
         ]]>
      </from>
      <until><![CDATA[
         $time <= xs:dateTime("?")
         ]]>
      </until>                    
    </where>
<!-- default result : return for GetRecord or ListRecords -->
    <return><![CDATA[
         return <TEI>
	        <div2>
		 {$a/@id}
		 {$a/@type}
		 {$a/head}
		 {$a/byline/docAuthor}
		 {$a/docDate}
                 {$root/TEI.2/teiHeader}
                 <LastModified>{$time}</LastModified>
	        </div2>
		 <issueid>{$issue/@id}</issueid>
		</TEI>
       ]]>                
     </return>
<!-- result to return for ListIdentifiers -->
    <return verb="ListIdentifiers"><![CDATA[
        return <TEI>
	        <div2>
                {$a/@id}
                {$a/@type}
                <LastModified>{$time}</LastModified>
               </div2>
	       </TEI>
      ]]>                
    </return>
  </xquery>
